---
layout: post
title: "Redux"
date: 2021-02-28 18:14:00 +0800
author: Michael
categories: javascript
---

# 安装Redux
	npm install @reduxjs/toolkit
	npm install react-redux

# ./redux/reducers/index.js
	export default combineReducers({ logData });

# ./redux/reducers/logData.js
该代码主要作用是，当收到一个action事件后，把action事件对应的变量刷新到新的state中，除了action对应的变量被替换为新值后，state变量中其它属性保持不变。运行完该程序后，会得到一个新的state，而不是在原先的state中做部分修改。代码中使用了解构赋值。

	const initialState = {
	    messages: []
	};
	
	export default function (state = initialState, action) {
	    switch (action.type) {
	        case LOGDATA: {
	            const { messages } = action.payload;
	            return {
	                ...state,
	                messages: messages,
	            };
	        }
	        default:
	            return state;
	    }
	}

# ./redux/actions.js
该代码的作用是动态创建action事件的对象变量，该事件变量会发给reducer生成新的state变量。

	export const getLogData = messages => ({
	    type: LOGDATA,
	    payload: { messages }
	});

getLogData的变量可以自定义，只需要在LogFileList.js中调用的时候保持一致就可以了。
	export const getLogData = (messages,length) => ({
	    type: LOGDATA,
	    payload: { messages,length }
	});


# ./components/LogFileList.js
该代码的目的是向普通的React组件属性props中注入getLogData函数，getLogData函数在./redux/actions.js中定义，getLogData的作用是把输入的messages变量转换为action事件变量，转化完成后，再把新的事件变量发给./redux/reducers/logData.js处理，整个过程的目的是修改redux的state值。当LogFileList组件需要修改redux的state值时，直接调用函数this.props.getLogData(messages)即可。this.props.getLogData()函数中传入的参数应和./redux/actions.js中定义的变量数量保持一致。

	class LogFileList extends React.Component {
	...
		this.props.getLogData(messages);
	...
	}

	export default connect(
	    null,
	    { getLogData }
	)(LogFileList);

# ./components/LogData.js
该代码的目的是向React组件属性props中注入state.logData的变量值，即messages变量。当redux检测到state.logData改变时，会自动刷新属性props的值，并重新渲染组件。

	class LogData extends React.Component {
	...
		this.props.messages
	...
	}


	const mapStateToProps = state => {
		return state.logData;
	};
	
	export default connect(mapStateToProps)(LogData);
