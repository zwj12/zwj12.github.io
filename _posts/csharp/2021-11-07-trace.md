---
layout: post
title: "System.Diagnostics.Trace"
date: 2021-11-07 17:36:00 +0800
author: Michael
categories: CSharp
---

# Quick Trace Code
    public static class QuickTrace
    {
        static TextWriterTraceListener textWriterTraceListener;

        public static void WriteLog(string strLog, string category = "")
        {
            if (textWriterTraceListener is null)
            {
                textWriterTraceListener = new TextWriterTraceListener("D:\\" + "ProjectOperate_" + DateTime.Now.ToString("yyyy-MM-dd") + ".log");
                Trace.Listeners.Add(textWriterTraceListener);
                Trace.AutoFlush = true;
            }
            if (string.IsNullOrEmpty(category))
            {
                category = "Category";
            }
            Trace.WriteLine(DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss.fff ") + category + " " + strLog + Environment.NewLine);

        }

    }

# Listeners
 The Listeners collection is shared by both the Debug and the Trace classes; adding a trace listener to either class adds the listener to both

# EventLog
事件日志有两个重要的属性，一个是事件来源，一个是事件日志名，这两个在创建的时候就已经一一对应好了，后期是不能改的。当添加日志时，不指定日志名时，系统会自动搜索对应的事件来源所对应的日志名。创建事件来源需要管理员权限。
    EventLog eventLog1 = new EventLog();
    if (!EventLog.SourceExists("TestMichaelSource"))
    {
        EventLog.CreateEventSource(
            "TestMichaelSource", "TestMichaelNewLog");
    }
    eventLog1.Source = "TestMichaelSource";
    //eventLog1.Log = "TestMichaelNewLog";
    eventLog1.WriteEntry("Monitoring the System", EventLogEntryType.Information, eventId++);
    eventLog1.WriteEntry("In OnStop.");
    eventLog1.WriteEntry("Monitoring the System", EventLogEntryType.Information, eventId++);
    eventLog1.WriteEntry("In OnStop.");

# Trace Category
Trace.WriteLine使用Category时，如果需要使用Filter，那么它的Filter级别是Verbose，原因不明。
	textWriterTraceListener.Filter = new EventTypeFilter(SourceLevels.Verbose);
	Trace.WriteLine("WriteLine", "Category");

# Trace Filter
Trace对应的Listener可以使用Filter功能，对应下面三个函数。
    Trace.TraceInformation("TraceInformation");
    Trace.TraceError("TraceError");
    Trace.TraceWarning("TraceWarning");
