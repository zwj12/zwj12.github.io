---
layout: post
title: "Log"
date: 2024-06-04 10:12:00 +0800
author: Michael
categories: CPP
---


# LogHelper

    #pragma once

    using namespace System;
    using namespace System::Diagnostics;

    ref class LogHelper
    {
    private:
        Object^ balanceLock = gcnew Object();
        TraceSource^ traceSource;

    public:
        property String^ LogName;
        property String^ LogFileDirectory;
        property String^ LogFilePath;
        property bool LogFileNameDateSuffix;
        property long ArchiveAboveSize;
        property int MaxArchiveFiles;

        LogHelper(String^ logName, String^ fileDirectory, bool useDateSuffix, long archiveFileSize, int archiveFileQuantity, SourceLevels sourceLevels);
        void ArchiveLogFile(String^ logFilePath);
        void Flush();
        void WriteLog(TraceEventType eventType, String^ strLog);
        void WriteLog(TraceEventType eventType, Exception^ ex);

    };


    #include "pch.h"
    #include "LogService.h"

    LogService::LogService()
    {
        String^ logDirectory = gcnew String("C:\\ProgramData\\ABB\\PickMaster Twin\\PickMaster Twin Host\\PickMaster Operator\\Log\\CPP");
        Directory::CreateDirectory(logDirectory);
        Init(logDirectory, 10000000,5);
    }

    void LogService::Init(String^ fileDirectory, long archiveFileSize, int archiveFileQuantity)
    {
        if (LogHelper != nullptr)
        {
            return;
        }
        else
        {
            if (Directory::Exists(fileDirectory))
            {
                LogDirectory = fileDirectory;
                LogHelper = gcnew ::LogHelper("CPP", LogDirectory, false, 10000000, 5, SourceLevels::All);
            }
        }
    }

# LogService

    #pragma once
    #include "LogHelper.h"

    using namespace System;
    using namespace System::IO;

    ref class LogService
    {
    private:
        static  Lazy<LogService^>^ lazy = gcnew Lazy<LogService^>();
    

    public:

        LogService();

        property static LogService^ Current
        {
            LogService^ get()
            {
                return lazy->Value;
            }
        }

        property String^ LogDirectory;
        property LogHelper^ LogHelper;

        void Init(String^ fileDirectory, long archiveFileSize, int archiveFileQuantity);

    };


    #include "pch.h"
    #include "LogService.h"

    LogService::LogService()
    {
        String^ logDirectory = gcnew String("C:\\ProgramData\\ABB\\PickMaster Twin\\PickMaster Twin Host\\PickMaster Operator\\Log\\CPP");
        Directory::CreateDirectory(logDirectory);
        Init(logDirectory, 10000000,5);
    }

    void LogService::Init(String^ fileDirectory, long archiveFileSize, int archiveFileQuantity)
    {
        if (LogHelper != nullptr)
        {
            return;
        }
        else
        {
            if (Directory::Exists(fileDirectory))
            {
                LogDirectory = fileDirectory;
                LogHelper = gcnew ::LogHelper("CPP", LogDirectory, false, 10000000, 5, SourceLevels::All);
            }
        }
    }

# main

    LogService::Current->LogHelper->WriteLog(TraceEventType::Information, "Test log message");