---
layout: post
title: "Lib & DLL"
date: 2022-06-26 19:50:00 +0800
author: Michael
categories: CPP
---

# 静态库(Static Library) .lib
1. 创建静态库项目，可以通过Static Library项目模板，也可以通过Windows Desktop Wizard项目模板创建。
2. 创建常规项目，右击References，引用静态库项目
3. 右击项目属性页，设置为“所有配置”，“所有平台”，在"Configuration Properties" -> “C/C++” -> "General" -> "Additional Include Directories"中指定静态库的头文件目录。
4. 在代码中引用静态库头文件，使用静态库的函数
5. 编译常规项目会自动编译静态库项目。
6. 程序运行时，不需要静态库

# 动态链接库(Dynamic-Link Library) .dll
1. 创建动态链接库项目，可以通过Dynamic-Link Library项目模板，也可以通过Windows Desktop Wizard项目模板创建。
2. 动态链接库项目的头文件比较特殊
3. 创建常规项目，不需要引用动态链接库
4. 右击项目属性页，设置为“所有配置”，“所有平台”，在"Configuration Properties" -> "Linker" -> "Input" -> "Additional Dependencies"中添加动态链接库的lib文件名（非dll文件）
5. 在"Configuration Properties" -> "Linker" -> "General" -> "Additional Library Directory"中添加动态链接库的目录，通常为解决方案文件夹下的“Debug”文件夹。可以使用相对路径"..\$(IntDir)"
6. 在代码中引用动态链接库头文件，使用动态链接库的函数
7. 编译常规项目不会自动编译动态链接库项目。
8. 程序运行时，需要动态链接库

# 动态链接库预处理指令 dllexport & dllimport
 DLL 项目的新项目模板将添加到 <PROJECTNAME>_EXPORTS 定义的预处理器宏中。 在此示例中，Visual Studio定义MATHLIBRARY_EXPORTS何时生成 MathLibrary DLL 项目。右击动态链接库项目属性 -> Configuration Properties -> C/C++ -> Preprocessor -> Preprocessor Definitions窗口中可以查看项目的预定义宏。

	// MathLibrary.h - Contains declarations of math functions
	#pragma once
	
	#ifdef MATHLIBRARY_EXPORTS
	#define MATHLIBRARY_API __declspec(dllexport)
	#else
	#define MATHLIBRARY_API __declspec(dllimport)
	#endif
	
	// The Fibonacci recurrence relation describes a sequence F
	// where F(n) is { n = 0, a
	//               { n = 1, b
	//               { n > 1, F(n-2) + F(n-1)
	// for some initial integral values a and b.
	// If the sequence is initialized F(0) = 1, F(1) = 1,
	// then this relation produces the well-known Fibonacci
	// sequence: 1, 1, 2, 3, 5, 8, 13, 21, 34, ...
	
	// Initialize a Fibonacci relation sequence
	// such that F(0) = a, F(1) = b.
	// This function must be called before any other function.
	extern "C" MATHLIBRARY_API void fibonacci_init(
	    const unsigned long long a, const unsigned long long b);
	
	// Produce the next value in the sequence.
	// Returns true on success and updates current value and index;
	// false on overflow, leaves current value and index unchanged.
	extern "C" MATHLIBRARY_API bool fibonacci_next();
	
	// Get the current value in the sequence.
	extern "C" MATHLIBRARY_API unsigned long long fibonacci_current();
	
	// Get the position of the current value in the sequence.
	extern "C" MATHLIBRARY_API unsigned fibonacci_index();

![日志文件夹](/assets/cpp/PreprocessorDefinitions.png)  
