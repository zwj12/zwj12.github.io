---
layout: post
title: "MFC"
date: 2022-07-06 19:23:00 +0800
author: Michael
categories: CPP
---

# MFC项目模板安装
Visual Studio c++ 缺省的安装是没有MFC项目模板的，需要安装MFC项目模板。   
![日志文件夹](/assets/cpp/InstallCPPMFC.png)  
![日志文件夹](/assets/cpp/MFCApp.png)  
![日志文件夹](/assets/cpp/MFCApplicationTypeOptions.png)  

# MSDN Download
如果希望Visual Studio在开发时能查看本地的SDK手册，需要下载Windows Driver Kit (WDK)手册。  
![日志文件夹](/assets/cpp/WindowsSDKManualDownload.png)  
![日志文件夹](/assets/cpp/ListView_GetExtendedListViewStyle_macro.png)  

# MyApp.h
窗口类基类为CFrameWnd，头文件中需要定义消息宏。  

	#pragma once
	
	#include<afxwin.h>
	
	class MyApp :
	    public CWinApp
	{
	public:
	    virtual BOOL InitInstance();
	
	};
	
	class MyFrame :public CFrameWnd {
	
	public:
	    MyFrame();
	
	    DECLARE_MESSAGE_MAP()
	
	    afx_msg void OnLButtonDown(UINT, CPoint);
	    afx_msg void OnChar(UINT, UINT, UINT);
	    afx_msg void OnPaint();
	};

# MyApp.cpp
cpp文件中需要在BEGIN_MESSAGE_MAP和END_MESSAGE_MAP之间进行消息映射。  

	#include "MyApp.h"
	
	MyApp app;
	
	BOOL MyApp::InitInstance()
	{
	    MyFrame* frame = new MyFrame();
	    frame->ShowWindow(SW_SHOWNORMAL);
	    frame->UpdateWindow();
	
	    this->m_pMainWnd = frame;
	
	    return TRUE;
	}
	
	BEGIN_MESSAGE_MAP(MyFrame, CFrameWnd)
	    ON_WM_LBUTTONDOWN()
	    ON_WM_CHAR()
	    ON_WM_PAINT()
	
	END_MESSAGE_MAP()
	
	MyFrame::MyFrame()
	{
	    Create(NULL, TEXT("MFC WINDOW"));
	}
	
	void MyFrame::OnLButtonDown(UINT, CPoint point)
	{
	    //TCHAR buf[1024];
	    //wsprintf(buf,TEXT("x=%d, y=%d"),point.x,point.y);
	    //MessageBox(buf);
	
	    CString str;
	    str.Format(TEXT("x=%d, y=%d"), point.x, point.y);
	    MessageBox(str);
	}
	
	void MyFrame::OnChar(UINT key, UINT, UINT)
	{
	    TCHAR buf[1024];
	    wsprintf(buf, TEXT("Print: %c"), key);
	    MessageBox(buf);
	
	    //Multi-Byte Character Set
	    char p[100] = "aaaa";
	    int n = 0;
	    n = strlen(p);
	
	    //Unicode Character Set
	    wchar_t p2[100] = L"bbbb";
	    int m = wcslen(p2);
	}
	
	void MyFrame::OnPaint()
	{   
	    CPaintDC dc(this);
	    dc.TextOutW(100, 100, TEXT("Hello World"));
	    dc.Ellipse(10, 10, 100, 100);
	}

![日志文件夹](/assets/cpp/MFCEmptyProject.png) 

# ICON
ICON图标文件复制到项目\res文件夹下，然后右击资源视图的Icon文件夹 -> Add Resources -> Import导入图标资源。  
![日志文件夹](/assets/cpp/AddIcon.png) 

# Tree Control
	//.h
	CImageList imageList;

	//.cpp
	HICON icon[4];
	icon[0] = AfxGetApp()->LoadIconW(IDI_ICON1);
	icon[1] = AfxGetApp()->LoadIconW(IDI_ICON2);
	icon[2] = AfxGetApp()->LoadIconW(IDI_ICON3);
	icon[3] = AfxGetApp()->LoadIconW(IDI_ICON4);
		
	imageList.Create(30,30,ILC_COLOR32,4,4);
	for (size_t i = 0; i < 4; i++)
	{
		imageList.Add(icon[i]);
	}

	m_Tree.SetImageList(&imageList, TVSIL_NORMAL);

	HTREEITEM rootItem= m_Tree.InsertItem(TEXT("根节点"), 0, 0);
	HTREEITEM parentItem= m_Tree.InsertItem(TEXT("子节点"), 1, 1, rootItem);
	HTREEITEM subItem1=	m_Tree.InsertItem(TEXT("子节点"), 2, 2, parentItem);
	HTREEITEM subItem2=m_Tree.InsertItem(TEXT("子节点"), 3, 3, parentItem);

	m_Tree.SelectItem(subItem1);


	void CMFCApplication2Dlg::OnTvnSelchangedTree1(NMHDR* pNMHDR, LRESULT* pResult)
	{
		LPNMTREEVIEW pNMTreeView = reinterpret_cast<LPNMTREEVIEW>(pNMHDR);
		// TODO: Add your control notification handler code here
		HTREEITEM subItem2 = m_Tree.GetSelectedItem();
		CString str = m_Tree.GetItemText(subItem2);
		MessageBox(str);
	
		*pResult = 0;
	}

# Tab Control
	Dialog.Border=None
	Dialog.Style=Child

	//.h
	CDlg01 cdlg1;
	CDlg1 cdlg2;

	//.cpp
	m_tab.InsertItem(0, TEXT("第一页"));
	m_tab.InsertItem(1, TEXT("第二页"));

	cdlg1.Create(IDD_DIALOG1, &m_tab);
	cdlg2.Create(IDD_DIALOG2, &m_tab);
	CRect rs;
	m_tab.GetClientRect(&rs);
	rs.top += 20;//调整子对话框在父窗口中的位置 
	rs.bottom -= 1;
	rs.left += 1;
	rs.right -= 2;
	cdlg1.MoveWindow(&rs);//设置子对话框尺寸并移动到指定位置 
	cdlg2.MoveWindow(&rs);
	cdlg1.ShowWindow(true);//分别设置隐藏和显示 
	cdlg2.ShowWindow(false);
	m_tab.SetCurSel(0);//设置默


	void CMFCApplication2Dlg::OnTcnSelchangeTab1(NMHDR* pNMHDR, LRESULT* pResult)
	{
		// TODO: Add your control notification handler code here
	
		int CurSel = m_tab.GetCurSel();
		switch (CurSel)
		{
		case 0:
			cdlg1.ShowWindow(SW_SHOW);
			cdlg2.ShowWindow(SW_HIDE);
			break;
		case 1:
			cdlg1.ShowWindow(SW_HIDE);
			cdlg2.ShowWindow(SW_SHOW);
			break;
		default:
			;
		}
	
		*pResult = 0;
	}