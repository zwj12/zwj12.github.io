---
layout: post
title: "Encoder Parameter"
date: 2020-12-14 08:17:00 +0800
author: Michael
categories: Laser3DSensors
---

在使用线激光对物体扫描时，为了获得物体的3D点云，有两种扫描方式：一种是线激光静止，物体随传送带或导轨移动获得整个物体的3D点云图；另一种是物体静止，线激光传感器随高精度导轨移动，获得整个物体的3D点云图。由于线激光是一帧一帧的获取图像，为了获取整个物体的3D点云图，它需要把很多帧的图像最终汇总到一个点云图中，也就是说，线激光在扫描时，其实是对物体进行了一个平均等分的切片处理。切片的精度会直接影响3D点云图的真实度。通常，我们为了提高精度，会在导轨或传送带上安装一个编码器，由于编码器的精度极高，这样，当导轨或传送带移动时，编码器会根据移动的固定距离，准确的发出采集图像的脉冲信号。在设置线激光编码器采集脉冲信号参数时，有两种方式可以获取该参数：一种是让导轨或传送带移动固定的距离，例如1m，然后查看线激光传感器所接收到的编码器AB相脉冲信号数量，例如采集到10000个脉冲信号，然后根据项目所需要达到的扫描精度，例如0.5mm，那么我们就可以估算出每5（=10000/(1/0.005))个脉冲采集一个图像的参数；还有一种方式就是通过编码器，减速机，导轨齿轮参数的数据，准确计算出每一幅图像的编码器脉冲信号数。通常推荐第二种，因为第二种更精确。本文将阐述第二种计算脉冲数的方式，我们通过机器人安装在导轨上，然后机器人手持线激光固定不动，导轨移动扫描物体为例：

首先，如果需要通过物理参数计算出编码器与导轨移动距离的关系，我们需要通过资料查阅获取以下物理量：

1. 减速机减速比例(编码器安装在减速箱导轨齿轮侧），iR (Ratio) = 8:1
2. 传动比，RTGR (Robot Transmission Gear Ratio) = 314 (rad/m)
3. 编码器每转一圈的脉冲数，EPC (Incremental rotary encoder Cycle Count) = 2048

通过以上几个参数，我们就可以开始计算了：

1. 导轨每米齿轮转动弧度数：RPM (Radian per Meter) = RTGR/iR
2. 导轨每米脉冲数：CPM (Cycles per Meter) = EPC*(RPM/(2π)) = EPC*((RTGR/iR)/(2π)) = 2048*((314/8)/(2*3.14))= 12800
3. 编码器每脉冲导轨移动距离：DPC (Distance per full cycle) = 1000/CPM = 1000/12800 = 0.078125

以上是设备的固有理论参数，当用于实际项目时，我们还需要针对项目设备的负载和精度做一个优化，线激光的扫描频率不是越快越好，扫描过快，有可能导致传感器超频，图像丢失。通常情况下，线激光扫描的精度保证在0.5mm就可以了。所以我们可以设置如下参数：

1. 线激光触发扫描脉冲频率(考虑到AB相4倍脉冲模式)：SPL (Steps per line) = 0.5/DPC*4 = 25.6 ≈ 25
2. 线激光扫描精度：Accuracy = DPC/4* SPL = 0.078125/4*25=0.48828125

另外线激光传感器的内存也是有限的，对于较长工件，可能需要分多幅图连续采集，如果一幅图采集的帧数超出线激光传感器的容量，也会导致图像丢失。例如我们可以把一幅图设置为由500帧组成，那么：

1. 每幅图的线扫帧数：PPF (Profiles per Frame) = 500
2. 每幅图的导轨移动的距离：DPF (Distance per Frame) = Accuracy * PPF = 0.48828125*500=244.140625
3. 对于一个10m长的工件，需要扫描图像数量为：10000/244.140625 = 40.96 ≈ 41

注意：  
在设置线激光触发扫描脉冲频率SPL时(Y向分辨率)，除了需要参考项目的精度要求，还需要参考X方向的分辨率，一般推荐X向和Y向的精度保持相当，这样可以使采集的图像长宽比更符合实际工件，后期使用视觉算法获取特征时也更容易。